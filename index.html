<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe Game</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/lobby.css">
    <link rel="stylesheet" href="css/chat.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/tic-tac-toe.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300">
    <div class="game-container">
        <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-6">Tic Tac Toe</h1>

        <div class="absolute top-4 right-4">
            <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 transition-colors duration-200">
                <i class="fas fa-sun dark:hidden"></i>
                <i class="fas fa-moon hidden dark:inline"></i>
            </button>
        </div>

        <div id="modeSelection" class="mode-selection text-center hidden">
            <h2 class="text-2xl font-semibold mb-6">Choose Game Mode</h2>
            <div class="space-y-4">
                <button id="localPvPButton" class="mode-button bg-green-500 hover:bg-green-600 w-full">
                    <i class="fas fa-users mr-2"></i> Local Player vs. Player
                </button>
                <button id="pvcModeButton" class="mode-button bg-yellow-500 hover:bg-yellow-600 w-full">
                    <i class="fas fa-robot mr-2"></i> Player vs. AI
                </button>
                <button id="onlinePvPButton" class="mode-button bg-blue-500 hover:bg-blue-600 w-full">
                    <i class="fas fa-globe mr-2"></i> Online Multiplayer
                </button>
            </div>
        </div>

        <div id="localPvPSetupSection" class="setup-section text-center hidden">
            <h2 class="text-2xl font-semibold mb-6">Local PvP Setup</h2>
            <div class="input-group">
                <label for="playerXNameInput" class="block mb-2 font-medium">Player X Name (X)</label>
                <input type="text" id="playerXNameInput" value="Player X" placeholder="Enter name" class="player-name-input">
            </div>
            <div class="input-group">
                <label for="playerONameInput" class="block mb-2 font-medium">Player O Name (O)</label>
                <input type="text" id="playerONameInput" value="Player O" placeholder="Enter name" class="player-name-input">
            </div>
            <button id="startLocalGameButton" class="action-button bg-green-500 hover:bg-green-600 mt-4">Start Local Game</button>
            <button id="backToModesFromLocalSetup" class="back-button">Back to Modes</button>
        </div>

        <div id="pvcSetupSection" class="setup-section text-center hidden">
            <h2 class="text-2xl font-semibold mb-6">Player vs. AI Setup</h2>
            <div class="input-group">
                <label for="pvcPlayerNameInput" class="block mb-2 font-medium">Your Name (X)</label>
                <input type="text" id="pvcPlayerNameInput" value="Human Player" placeholder="Enter your name" class="player-name-input">
            </div>
            <div class="input-group mb-4">
                <label class="block mb-2 font-medium">AI Difficulty (O)</label>
                <div id="aiDifficultySelector" class="flex justify-center space-x-4">
                    <label class="inline-flex items-center">
                        <input type="radio" name="ai_difficulty" id="aiEasyButton" value="easy" class="form-radio text-green-500" checked>
                        <span class="ml-2">Easy</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="ai_difficulty" id="aiMediumButton" value="medium" class="form-radio text-yellow-500">
                        <span class="ml-2">Medium</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="ai_difficulty" id="aiHardButton" value="hard" class="form-radio text-red-500">
                        <span class="ml-2">Hard</span>
                    </label>
                </div>
            </div>
            <button id="startPvCButton" class="action-button bg-yellow-500 hover:bg-yellow-600 mt-4">Start Game vs. AI</button>
            <button id="backToModesFromPvC" class="back-button">Back to Modes</button>
        </div>

        <div id="onlineLobbySection" class="lobby-section text-center hidden">
            <h2 class="text-2xl font-semibold mb-6">Online Lobby</h2>
            <div class="info-section p-3 rounded-lg shadow mb-4">
                <p>Your User ID: <span id="userIdDisplay" class="font-bold">...</span></p>
                <div class="flex items-center justify-center mt-2">
                    <label for="onlinePlayerNameInput" class="mr-2 font-medium">Your Name:</label>
                    <input type="text" id="onlinePlayerNameInput" placeholder="Enter your name" class="player-name-input max-w-xs">
                </div>
                <p class="mt-2">Display Name: <span id="currentUserNameDisplay" class="font-bold">...</span></p>
            </div>
            
            <h3 class="text-xl font-semibold mt-6 mb-4">Create New Game</h3>
            <div class="flex flex-col items-center space-y-3">
                <input type="text" id="newGameNameInput" placeholder="Optional Game Name" class="player-name-input max-w-xs">
                <label class="inline-flex items-center">
                    <input type="checkbox" id="privateGameCheckbox" class="form-checkbox text-blue-500">
                    <span class="ml-2">Private Game (Join by ID only)</span>
                </label>
                <button id="createGameButton" class="action-button bg-blue-500 hover:bg-blue-600 w-full max-w-xs">
                    <i class="fas fa-plus-circle mr-2"></i> Create Game (Play as X)
                </button>
            </div>

            <h3 class="text-xl font-semibold mt-8 mb-4">Join Private Game</h3>
            <div class="flex flex-col items-center space-y-3">
                <input type="text" id="joinGameIdInput" placeholder="Enter Game ID" class="player-name-input max-w-xs">
                <button id="joinGameButton" class="action-button bg-blue-500 hover:bg-blue-600 w-full max-w-xs">
                    <i class="fas fa-sign-in-alt mr-2"></i> Join Game (Play as O)
                </button>
            </div>

            <h3 class="text-xl font-semibold mt-8 mb-4">Public Games</h3>
            <div id="publicGamesList" class="public-lobby p-4 rounded-lg shadow-inner max-h-60 overflow-y-auto">
                </div>
            
            <button id="backToModesFromOnline" class="back-button">Back to Modes</button>
        </div>


        <div id="gameArea" class="game-area text-center hidden">
            <div class="info-section p-3 rounded-lg shadow mb-4">
                <p>Game ID: <span id="gameIdDisplay" class="font-bold">...</span> <button id="copyGameIdButton" class="text-blue-500 hover:text-blue-700 ml-2"><i class="fas fa-copy"></i></button></p>
            </div>
            
            <p id="gameStatus" class="status text-xl font-semibold mb-4">Status: Game not started.</p>

            <div class="game-grid">
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>

            <div class="score-display text-lg font-medium space-x-4 mb-4">
                <span id="xScore">X: 0</span>
                <span id="oScore">O: 0</span>
                <span id="draws">Draws: 0</span>
            </div>

            <div class="game-buttons-container">
                <button id="startNewRoundButton" class="action-button bg-green-500 hover:bg-green-600 hidden">Start New Round</button>
                <button id="resetButton" class="action-button bg-red-500 hover:bg-red-600 hidden">Reset Score</button>
                <button id="leaveGameButton" class="action-button bg-red-500 hover:bg-red-600 hidden">Leave Game</button>
                <button id="exitSpectatorModeButton" class="action-button bg-red-500 hover:bg-red-600 hidden">Exit Spectating</button>
                <button id="backToModesFromGame" class="back-button">Back to Modes</button>
            </div>

            <div id="chatSection" class="hidden mt-6 p-4 rounded-lg shadow-inner">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">In-Game Chat</h3>
                <div id="chatMessages" class="chat-messages max-h-40 overflow-y-auto border rounded-md p-2 mb-3">
                    </div>
                <div class="flex gap-2">
                    <input type="text" id="chatInput" placeholder="Type your message..." class="flex-grow p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <button id="sendChatButton" class="action-button bg-blue-600 hover:bg-blue-700 px-4 py-2 text-sm">Send</button>
                </div>
            </div>
        </div>
    </div>

    <div id="customModal" class="modal-overlay hidden">
        <div class="modal-content">
            <p id="modalMessage" class="text-lg font-semibold text-gray-800 dark:text-gray-200"></p>
            <button id="modalCloseButton" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">OK</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script type="module" src="js/main.js"></script>
</body>
</html>